import{m as e,o as r,p as a,b as s,q as t,t as o,l as c,h as i,v as n,j as l}from"../../../_/nitro.mjs";import{r as y}from"../../../_/auth.mjs";import"node:async_hooks";const d={};function hubVectorize(c){if(e("vectorize"),d[c])return d[c];const i=r().hub,n=`VECTORIZE_${c.toUpperCase()}`,l=a.env[n]||globalThis.__env__?.[n]||globalThis[n];if(i.remote&&i.projectUrl&&!l)return d[c]=function(r,a,s){e("vectorize");const c=t.create({baseURL:o(a,`/api/_hub/vectorize/${r}`),method:"POST",headers:{Authorization:`Bearer ${s}`}});return{insert:async e=>c("/insert",{body:{vectors:e}}).catch(handleProxyError),upsert:async e=>c("/upsert",{body:{vectors:e}}).catch(handleProxyError),query:async(e,r)=>c("/query",{body:{query:e,params:r}}).catch(handleProxyError),getByIds:async e=>c("/getByIds",{body:{ids:e}}).catch(handleProxyError),deleteByIds:async e=>c("/deleteByIds",{body:{ids:e}}).catch(handleProxyError),describe:async()=>c("/describe").catch(handleProxyError)}}(c,i.projectUrl,i.projectSecretKey||i.userToken),d[c];if(l)return d[c]=l,d[c];throw s(`Missing Cloudflare Vectorize binding (${n})`)}function handleProxyError(e){throw s({statusCode:e.statusCode,message:e.data?.message||e.message})}const h=c(async e=>{await y(e);const{version:a,cache:s,ai:t,analytics:o,browser:c,blob:d,kv:h,database:b,vectorize:u}=r().hub,[f,m,_,p]=await Promise.all([falseIfFail(()=>b&&i().exec("PRAGMA table_list")),falseIfFail(()=>h&&n().getKeys("__check__")),falseIfFail(()=>d&&l().list({prefix:"__check__"})),Promise.all(Object.keys(u).map(async e=>{const r=hubVectorize(e),a=await falseIfFail(()=>r.describe());return[e,Boolean(a)]}))]),v=Object.fromEntries(Object.entries(u).filter(([e])=>p.find(([r,a])=>r===e&&a)));return{version:a,storage:{database:Boolean(f),kv:Array.isArray(m),blob:Array.isArray(_?.blobs),vectorize:v},features:{ai:t,analytics:o,browser:c,cache:s}}});async function falseIfFail(e){try{const r=e();return r instanceof Promise?r.catch(()=>!1):r}catch(e){return!1}}export{h as default};
//# sourceMappingURL=manifest.get.mjs.map
