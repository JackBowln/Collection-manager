import{d as i,e as t,g as e,h as a,b as s,f as r}from"../../../../_/nitro.mjs";import"node:async_hooks";const o=i(async i=>{const{user:o}=await t(i),n=e(i,"id"),d=a(),c=await d.prepare("SELECT user_id, visibility FROM collections WHERE id = ?").bind(n).first();if(!c)throw s({statusCode:404,message:"Not found"});if(c.user_id!==o.id&&"private"===c.visibility){if(!await d.prepare("SELECT id FROM collection_shares WHERE collection_id = ? AND user_id = ?").bind(n,o.id).first())throw s({statusCode:403,message:"Forbidden"})}if("GET"===i.method){return(await d.prepare("\n      SELECT c.*, p.full_name, p.avatar_url\n      FROM comments c\n      JOIN profiles p ON p.id = c.user_id\n      WHERE c.collection_id = ?\n      ORDER BY c.created_at DESC\n    ").bind(n).all()).results}if("POST"===i.method){const t=await r(i),e=crypto.randomUUID();return await d.prepare("INSERT INTO comments (id, collection_id, user_id, content) VALUES (?, ?, ?, ?)").bind(e,n,o.id,t.content).run(),{id:e}}});export{o as default};
//# sourceMappingURL=comments.mjs.map
