import{d as e,e as s,g as a,h as i,b as r,f as t}from"../../../../_/nitro.mjs";import"node:async_hooks";const d=e(async e=>{const{user:d}=await s(e),o=a(e,"id"),l=i(),n=await l.prepare("SELECT user_id FROM collections WHERE id = ?").bind(o).first();if(!n||n.user_id!==d.id)throw r({statusCode:403,message:"Forbidden"});if("GET"===e.method){return(await l.prepare("\n      SELECT cs.id, cs.user_id, p.email, p.full_name, p.avatar_url\n      FROM collection_shares cs\n      JOIN profiles p ON p.id = cs.user_id\n      WHERE cs.collection_id = ?\n    ").bind(o).all()).results.map(e=>({id:e.id,user_id:e.user_id,profiles:{id:e.user_id,email:e.email,full_name:e.full_name,avatar_url:e.avatar_url}}))}if("POST"===e.method){const s=(await t(e)).email,a=await l.prepare("SELECT id FROM profiles WHERE email = ?").bind(s).first();if(!a)throw r({statusCode:404,message:"User not found"});const i=crypto.randomUUID();try{await l.prepare("INSERT INTO collection_shares (id, collection_id, user_id) VALUES (?, ?, ?)").bind(i,o,a.id).run()}catch(e){if(e.message.includes("UNIQUE"))throw r({statusCode:409,message:"Already shared"});throw e}return{success:!0}}});export{d as default};
//# sourceMappingURL=shares.mjs.map
