import{d as s,e as t,g as e,h as i,b as a,f as o}from"../../../../_/nitro.mjs";import"node:async_hooks";const r=s(async s=>{const{user:r}=await t(s),n=e(s,"id"),d=i(),c=await d.prepare("SELECT user_id FROM collections WHERE id = ?").bind(n).first();if(!c||c.user_id!==r.id)throw a({statusCode:403,message:"Forbidden"});const f=(await o(s)).items||[];if(!Array.isArray(f))throw a({statusCode:400,message:"Items must be an array"});const l=[];for(const s of f){const t=crypto.randomUUID();if(l.push(d.prepare("INSERT INTO items (id, collection_id) VALUES (?, ?)").bind(t,n)),s.values&&"object"==typeof s.values)for(const[e,i]of Object.entries(s.values))l.push(d.prepare("\n            INSERT INTO item_values (id, item_id, field_id, value)\n            VALUES (?, ?, ?, ?)\n          ").bind(crypto.randomUUID(),t,e,JSON.stringify(i)))}if(l.length>0){const s=10;for(let t=0;t<l.length;t+=s){const e=l.slice(t,t+s);await d.batch(e)}}return{imported:f.length}});export{r as default};
//# sourceMappingURL=import.mjs.map
