import{d as i,e,h as r,f as a}from"../../_/nitro.mjs";import"node:async_hooks";const n=i(async i=>{const{user:n}=await e(i),o=r();if("GET"===i.method){return(await o.prepare("SELECT * FROM collections WHERE user_id = ? ORDER BY created_at DESC").bind(n.id).all()).results}if("POST"===i.method){const e=await a(i),r=crypto.randomUUID();if(await o.prepare("SELECT id FROM profiles WHERE id = ?").bind(n.id).first()||(console.log("Restoring missing profile for",n.id),await o.prepare("\n            INSERT INTO profiles (id, email, full_name, avatar_url)\n            VALUES (?, ?, ?, ?)\n        ").bind(n.id,n.email,n.name,n.avatar).run()),await o.prepare("\n      INSERT INTO collections (id, user_id, name, description, visibility)\n      VALUES (?, ?, ?, ?, ?)\n    ").bind(r,n.id,e.name,e.description,e.visibility||"private").run(),e.fields&&Array.isArray(e.fields))for(const i of e.fields){const e=crypto.randomUUID();await o.prepare("\n          INSERT INTO fields (id, collection_id, name, type, options, folder_order, visible, required, is_dynamic)\n          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n        ").bind(e,r,i.name,i.type,JSON.stringify(i.options||[]),i.folder_order||0,i.visible?1:0,i.required?1:0,i.is_dynamic?1:0).run()}return{id:r}}});export{n as default};
//# sourceMappingURL=collections.mjs.map
