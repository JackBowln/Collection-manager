import{v as e,A as o,k as i,n as t,_ as a}from"./server.mjs";import{_ as l}from"./Card-CjK8ZZ2Z.mjs";import{_ as r,a as d}from"./Input-CWRe9pxK.mjs";import{_ as s,a as n,b as c}from"./FieldDefinition-WmOpqtMW.mjs";import{u}from"./fetch-CFsjn0J_.mjs";import{A as m,y as f,D as p,G as h}from"../routes/renderer.mjs";import"../_/nitro.mjs";import"node:async_hooks";import"../_/shared.esm-bundler.mjs";const x=e.defineComponent({__name:"edit",__ssrInlineRender:!0,async setup(x){let v,V;const C=o().params.id,y=i(),b=e.ref(!1),g=e.reactive({name:"",description:"",visibility:"private",fields:[]}),{data:_,error:w}=([v,V]=e.withAsyncContext(()=>u(`/api/collections/${C}`,"$lvG1zHeC2p")),v=await v,V(),v);e.watchEffect(()=>{if(_.value){const e=_.value;g.name=e.name,g.description=e.description,g.visibility=e.visibility||"private",g.fields=(e.fields||[]).sort((e,o)=>e.folder_order-o.folder_order).map(e=>({...e,is_dynamic:!!e.is_dynamic,selected:!1}))}w.value&&(y.add({title:"Erro",description:"Não foi possível carregar a coleção",color:"red"}),t("/dashboard"))});const addField=()=>{g.fields.push({tempId:Date.now(),name:"",type:"text",options:[],visible:!0,required:!1,selected:!1,is_dynamic:!1,folder_order:g.fields.length})},E=e.computed(()=>g.fields.some(e=>e.selected)),N=e.computed(()=>g.fields.filter(e=>e.selected).length),selectAllFields=()=>{g.fields.forEach(e=>e.selected=!0)},deselectAllFields=()=>{g.fields.forEach(e=>e.selected=!1)},deleteSelectedFields=async()=>{const e=g.fields.filter(e=>e.selected);if(0===e.length)return;if(!confirm(`Excluir ${e.length} campos? Isso executará a ação imediatamente e não poderá ser desfeito.`))return;const o=e.map(e=>e.id).filter(e=>!!e);if(o.length>0)try{await Promise.all(o.map(e=>$fetch(`/api/collections/${C}/fields/${e}`,{method:"DELETE"})))}catch(e){return void y.add({title:"Erro",description:e.message,color:"red"})}g.fields=g.fields.filter(e=>!e.selected),y.add({title:"Excluído",description:"Campos removidos",color:"green"})};return(o,i,t,u)=>{const x=a,v=l,V=r,_=d,w=s,$=n,j=c;i(`<div${m(e.mergeProps({class:"max-w-3xl mx-auto p-4"},u))}><div class="flex items-center gap-4 mb-6">`),i(f(x,{icon:"i-heroicons-arrow-left",variant:"ghost",to:`/collections/${e.unref(C)}`},null,t)),i('<h1 class="text-2xl font-bold">Editar Coleção</h1></div><form>'),i(f(v,{class:"mb-6"},{header:e.withCtx((o,i,t,a)=>{if(!i)return[e.createVNode("h2",{class:"font-semibold"},"Detalhes Básicos")];i(`<h2 class="font-semibold"${a}>Detalhes Básicos</h2>`)}),default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createVNode("div",{class:"space-y-4"},[e.createVNode(V,{label:"Nome da Coleção",required:""},{default:e.withCtx(()=>[e.createVNode(_,{modelValue:e.unref(g).name,"onUpdate:modelValue":o=>e.unref(g).name=o,placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e.createVNode(V,{label:"Descrição"},{default:e.withCtx(()=>[e.createVNode(w,{modelValue:e.unref(g).description,"onUpdate:modelValue":o=>e.unref(g).description=o},null,8,["modelValue","onUpdate:modelValue"])]),_:1})])];i(`<div class="space-y-4"${a}>`),i(f(V,{label:"Nome da Coleção",required:""},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createVNode(_,{modelValue:e.unref(g).name,"onUpdate:modelValue":o=>e.unref(g).name=o,placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue","onUpdate:modelValue"])];i(f(_,{modelValue:e.unref(g).name,"onUpdate:modelValue":o=>e.unref(g).name=o,placeholder:"ex. Discos de Vinil",required:""},null,t,a))}),_:1},t,a)),i(f(V,{label:"Descrição"},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createVNode(w,{modelValue:e.unref(g).description,"onUpdate:modelValue":o=>e.unref(g).description=o},null,8,["modelValue","onUpdate:modelValue"])];i(f(w,{modelValue:e.unref(g).description,"onUpdate:modelValue":o=>e.unref(g).description=o},null,t,a))}),_:1},t,a)),i("</div>")}),_:1},t)),i(f($,{modelValue:e.unref(g).visibility,"onUpdate:modelValue":o=>e.unref(g).visibility=o,"collection-id":e.unref(C),class:"mb-6"},null,t)),i('<div class="mb-6"><div class="flex flex-wrap gap-2 justify-between items-center mb-4 sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md py-4 border-b border-gray-200 dark:border-gray-800"><div class="flex items-center gap-2"><h2 class="text-lg font-semibold">Campos Personalizados</h2>'),e.unref(E)?(i('<div class="flex gap-2 ml-4">'),i(f(x,{size:"xs",color:"red",variant:"soft",onClick:deleteSelectedFields},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createTextVNode("Excluir Selecionados ("+e.toDisplayString(e.unref(N))+")",1)];i(`Excluir Selecionados (${p(e.unref(N))})`)}),_:1},t)),i(f(x,{size:"xs",color:"gray",variant:"ghost",onClick:deselectAllFields},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createTextVNode("Cancelar")];i("Cancelar")}),_:1},t)),i("</div>")):i(f(x,{size:"xs",color:"gray",variant:"ghost",onClick:selectAllFields},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createTextVNode("Selecionar Todos")];i("Selecionar Todos")}),_:1},t)),i("</div>"),i(f(x,{size:"sm",icon:"i-heroicons-plus",onClick:addField},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createTextVNode("Adicionar Campo")];i("Adicionar Campo")}),_:1},t)),i('</div><div class="space-y-4">\x3c!--[--\x3e'),h(e.unref(g).fields,(o,a)=>{i(f(j,{key:o.tempId||o.id||a,modelValue:e.unref(g).fields[a],"onUpdate:modelValue":o=>e.unref(g).fields[a]=o,onRemove:e=>(async e=>{const o=g.fields[e];if(o.id){if(!confirm(`Tem certeza que deseja excluir o campo "${o.name}"? Todos os dados deste campo serão perdidos!`))return;try{await $fetch(`/api/collections/${C}/fields/${o.id}`,{method:"DELETE"})}catch(e){return void y.add({title:"Erro",description:e.message,color:"red"})}}g.fields.splice(e,1)})(a)},null,t))}),i('\x3c!--]--\x3e</div></div><div class="flex justify-end gap-3 z-20 relative">'),i(f(x,{to:`/collections/${e.unref(C)}`,color:"gray",variant:"ghost"},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createTextVNode("Cancelar")];i("Cancelar")}),_:1},t)),i(f(x,{type:"submit",loading:e.unref(b)},{default:e.withCtx((o,i,t,a)=>{if(!i)return[e.createTextVNode("Salvar Alterações")];i("Salvar Alterações")}),_:1},t)),i("</div></form></div>")}}}),v=x.setup;x.setup=(o,i)=>{const t=e.useSSRContext();return(t.modules||(t.modules=new Set)).add("pages/collections/[id]/edit.vue"),v?v(o,i):void 0};export{x as default};
//# sourceMappingURL=edit-CRUflC4B.mjs.map
