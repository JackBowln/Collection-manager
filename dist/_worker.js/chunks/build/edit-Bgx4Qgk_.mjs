import{v as e,f as o,a as r,_ as t}from"./server.mjs";import{_ as i}from"./Card-Bfh9rD5X.mjs";import{_ as l,a}from"./Input-CUCmPBr7.mjs";import{_ as d}from"./Select-PkSwbjSb.mjs";import{_ as s,a as n}from"./FieldDefinition-CtRzfioR.mjs";import{u as c}from"./useSupabaseClient-CktZlRub.mjs";import{A as u,y as m,D as f,G as p}from"../routes/renderer.mjs";import"../nitro/nitro.mjs";import"node:process";import"node:async_hooks";import"../_/shared.esm-bundler.mjs";const x=e.defineComponent({__name:"edit",__ssrInlineRender:!0,setup(x){const h=o().params.id,v=c(),V=r(),C=e.ref(!1),b=e.reactive({name:"",description:"",visibility:"private",fields:[]}),addField=()=>{b.fields.push({tempId:Date.now(),name:"",type:"text",options:[],visible:!0,required:!1,selected:!1,folder_order:b.fields.length})},g=e.computed(()=>b.fields.some(e=>e.selected)),y=e.computed(()=>b.fields.filter(e=>e.selected).length),selectAllFields=()=>{b.fields.forEach(e=>e.selected=!0)},deselectAllFields=()=>{b.fields.forEach(e=>e.selected=!1)},deleteSelectedFields=async()=>{const e=b.fields.filter(e=>e.selected);if(0===e.length)return;if(!confirm(`Excluir ${e.length} campos? Isso executará a ação imediatamente e não poderá ser desfeito.`))return;const o=e.map(e=>e.id).filter(e=>!!e);if(o.length>0){const{error:e}=await v.from("fields").delete().in("id",o);if(e)return void V.add({title:"Erro",description:e.message,color:"red"})}b.fields=b.fields.filter(e=>!e.selected),V.add({title:"Excluído",description:"Campos removidos",color:"green"})};return(o,r,c,x)=>{const _=t,w=i,N=l,S=a,j=d,U=s,k=n;r(`<div${u(e.mergeProps({class:"max-w-3xl mx-auto p-4"},x))}><div class="flex items-center gap-4 mb-6">`),r(m(_,{icon:"i-heroicons-arrow-left",variant:"ghost",to:`/collections/${e.unref(h)}`},null,c)),r('<h1 class="text-2xl font-bold">Editar Coleção</h1></div><form>'),r(m(w,{class:"mb-6"},{header:e.withCtx((o,r,t,i)=>{if(!r)return[e.createVNode("h2",{class:"font-semibold"},"Detalhes Básicos")];r(`<h2 class="font-semibold"${i}>Detalhes Básicos</h2>`)}),default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createVNode("div",{class:"space-y-4"},[e.createVNode(N,{label:"Nome da Coleção",required:""},{default:e.withCtx(()=>[e.createVNode(S,{modelValue:e.unref(b).name,"onUpdate:modelValue":o=>e.unref(b).name=o,placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e.createVNode(N,{label:"Descrição"},{default:e.withCtx(()=>[e.createVNode(j,{modelValue:e.unref(b).description,"onUpdate:modelValue":o=>e.unref(b).description=o},null,8,["modelValue","onUpdate:modelValue"])]),_:1})])];r(`<div class="space-y-4"${i}>`),r(m(N,{label:"Nome da Coleção",required:""},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createVNode(S,{modelValue:e.unref(b).name,"onUpdate:modelValue":o=>e.unref(b).name=o,placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue","onUpdate:modelValue"])];r(m(S,{modelValue:e.unref(b).name,"onUpdate:modelValue":o=>e.unref(b).name=o,placeholder:"ex. Discos de Vinil",required:""},null,t,i))}),_:1},t,i)),r(m(N,{label:"Descrição"},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createVNode(j,{modelValue:e.unref(b).description,"onUpdate:modelValue":o=>e.unref(b).description=o},null,8,["modelValue","onUpdate:modelValue"])];r(m(j,{modelValue:e.unref(b).description,"onUpdate:modelValue":o=>e.unref(b).description=o},null,t,i))}),_:1},t,i)),r("</div>")}),_:1},c)),r(m(U,{modelValue:e.unref(b).visibility,"onUpdate:modelValue":o=>e.unref(b).visibility=o,"collection-id":e.unref(h),class:"mb-6"},null,c)),r('<div class="mb-6"><div class="flex flex-wrap gap-2 justify-between items-center mb-4 sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md py-4 border-b border-gray-200 dark:border-gray-800"><div class="flex items-center gap-2"><h2 class="text-lg font-semibold">Campos Personalizados</h2>'),e.unref(g)?(r('<div class="flex gap-2 ml-4">'),r(m(_,{size:"xs",color:"red",variant:"soft",onClick:deleteSelectedFields},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createTextVNode("Excluir Selecionados ("+e.toDisplayString(e.unref(y))+")",1)];r(`Excluir Selecionados (${f(e.unref(y))})`)}),_:1},c)),r(m(_,{size:"xs",color:"gray",variant:"ghost",onClick:deselectAllFields},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createTextVNode("Cancelar")];r("Cancelar")}),_:1},c)),r("</div>")):r(m(_,{size:"xs",color:"gray",variant:"ghost",onClick:selectAllFields},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createTextVNode("Selecionar Todos")];r("Selecionar Todos")}),_:1},c)),r("</div>"),r(m(_,{size:"sm",icon:"i-heroicons-plus",onClick:addField},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createTextVNode("Adicionar Campo")];r("Adicionar Campo")}),_:1},c)),r('</div><div class="space-y-4">\x3c!--[--\x3e'),p(e.unref(b).fields,(o,t)=>{r(m(k,{key:o.tempId||o.id||t,modelValue:e.unref(b).fields[t],"onUpdate:modelValue":o=>e.unref(b).fields[t]=o,onRemove:e=>(async e=>{const o=b.fields[e];if(o.id){if(!confirm(`Tem certeza que deseja excluir o campo "${o.name}"? Todos os dados deste campo serão perdidos!`))return;const{error:e}=await v.from("fields").delete().eq("id",o.id);if(e)return void V.add({title:"Erro",description:e.message,color:"red"})}b.fields.splice(e,1)})(t)},null,c))}),r('\x3c!--]--\x3e</div></div><div class="flex justify-end gap-3 z-20 relative">'),r(m(_,{to:`/collections/${e.unref(h)}`,color:"gray",variant:"ghost"},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createTextVNode("Cancelar")];r("Cancelar")}),_:1},c)),r(m(_,{type:"submit",loading:e.unref(C)},{default:e.withCtx((o,r,t,i)=>{if(!r)return[e.createTextVNode("Salvar Alterações")];r("Salvar Alterações")}),_:1},c)),r("</div></form></div>")}}}),h=x.setup;x.setup=(o,r)=>{const t=e.useSSRContext();return(t.modules||(t.modules=new Set)).add("pages/collections/[id]/edit.vue"),h?h(o,r):void 0};export{x as default};
//# sourceMappingURL=edit-Bgx4Qgk_.mjs.map
