import{_ as e}from"./Card-Dskk1veu.mjs";import{v as a,u as r,a as l,e as t,c as o,_ as i}from"./server.mjs";import{_ as s,a as n}from"./Input-D0kU1oTm.mjs";import{_ as d}from"./Toggle-DHexaQQc.mjs";import{u}from"./useSupabaseClient-CBvWxwze.mjs";import{u as c}from"./composables-ClCBAzHB.mjs";import{A as m,y as f}from"../routes/renderer.mjs";import"../_/nitro.mjs";import"node:async_hooks";import"../_/shared.esm-bundler.mjs";import"./keyboard-DfXvXu8t.mjs";const p=a.defineComponent({__name:"settings",__ssrInlineRender:!0,setup(p){const v=u(),g=r(),h=l(),x=c(),y=a.ref(!1),V=a.reactive({full_name:"",avatar_url:""});a.watchEffect(()=>{g.value&&(V.full_name=g.value.user_metadata.full_name||"",V.avatar_url=g.value.user_metadata.avatar_url||"")});const toggleTheme=e=>{x.preference=e?"dark":"light"},_=a.ref(!1),w=a.ref(null),triggerFileInput=()=>{var e;null==(e=w.value)||e.click()},handleFileUpload=async e=>{const a=e.target.files[0];if(a&&g.value)if(a.type.startsWith("image/"))try{_.value=!0;const e=a.name.split(".").pop(),r=`profiles/${`${g.value.id}-${Date.now()}.${e}`}`,{error:l}=await v.storage.from("avatars").upload(r,a,{upsert:!0});if(l)throw l;const{data:{publicUrl:t}}=v.storage.from("avatars").getPublicUrl(r);V.avatar_url=t,h.add({title:"Upload concluído",color:"green"})}catch(e){e.message.includes("bucket not found")?h.add({title:"Erro de Configuração",description:'Bucket "avatars" não encontrado. Verifique o guia.',color:"red"}):h.add({title:"Erro no Upload",description:e.message,color:"red"})}finally{_.value=!1}else h.add({title:"Erro",description:"Por favor envie apenas imagens.",color:"red"})},updateProfile=async()=>{var e;try{y.value=!0;const a={id:null==(e=g.value)?void 0:e.id,full_name:V.full_name,avatar_url:V.avatar_url},{error:r}=await v.from("profiles").upsert(a);if(r)throw r;const{error:l}=await v.auth.updateUser({data:{full_name:V.full_name,avatar_url:V.avatar_url}});if(l)throw l;h.add({title:"Perfil atualizado",color:"green"})}catch(e){h.add({title:"Erro ao atualizar",description:e.message,color:"red"})}finally{y.value=!1}};return(r,l,u,c)=>{const p=e,v=o,h=t,b=i,N=s,k=n,C=d;l(`<div${m(a.mergeProps({class:"max-w-2xl mx-auto py-8"},c))}><div class="flex items-center gap-4 mb-8"><h1 class="text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent">Minha Conta</h1></div><div class="space-y-6">`),l(f(p,null,{header:a.withCtx((e,r,l,t)=>{if(!r)return[a.createVNode("div",{class:"flex items-center gap-3"},[a.createVNode("div",{class:"p-2 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-primary-500"},[a.createVNode(v,{name:"i-heroicons-user",class:"w-5 h-5"})]),a.createVNode("h3",{class:"font-semibold text-lg"},"Perfil")])];r(`<div class="flex items-center gap-3"${t}><div class="p-2 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-primary-500"${t}>`),r(f(v,{name:"i-heroicons-user",class:"w-5 h-5"},null,l,t)),r(`</div><h3 class="font-semibold text-lg"${t}>Perfil</h3></div>`)}),default:a.withCtx((e,r,l,t)=>{var o,i,s,n;if(!r)return[a.createVNode("form",{onSubmit:a.withModifiers(updateProfile,["prevent"]),class:"space-y-6"},[a.createVNode("div",{class:"flex flex-col items-center sm:flex-row gap-6 mb-6"},[a.createVNode("div",{class:"relative group cursor-pointer",onClick:triggerFileInput},[a.createVNode(h,{src:a.unref(V).avatar_url||(null==(n=null==(s=a.unref(g))?void 0:s.user_metadata)?void 0:n.avatar_url),alt:a.unref(V).full_name,size:"3xl",class:"ring-4 ring-gray-100 dark:ring-gray-800 transition-opacity group-hover:opacity-75"},null,8,["src","alt"]),a.createVNode("div",{class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[a.createVNode(v,{name:"i-heroicons-camera",class:"w-8 h-8 text-gray-800 dark:text-white drop-shadow-md"})]),a.unref(_)?(a.openBlock(),a.createBlock("div",{key:0,class:"absolute inset-0 bg-white/50 dark:bg-black/50 rounded-full flex items-center justify-center"},[a.createVNode(v,{name:"i-heroicons-arrow-path",class:"w-8 h-8 animate-spin text-primary-500"})])):a.createCommentVNode("",!0)]),a.createVNode("input",{ref_key:"fileInput",ref:w,type:"file",class:"hidden",accept:"image/*",onChange:handleFileUpload},null,544),a.createVNode("div",{class:"flex-1 w-full space-y-4"},[a.createVNode("div",{class:"flex gap-2"},[a.createVNode(b,{color:"white",icon:"i-heroicons-arrow-up-tray",loading:a.unref(_),onClick:triggerFileInput},{default:a.withCtx(()=>[a.createTextVNode(" Upload de Foto ")]),_:1},8,["loading"]),a.unref(V).avatar_url?(a.openBlock(),a.createBlock(b,{key:0,color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",onClick:e=>a.unref(V).avatar_url=""},null,8,["onClick"])):a.createCommentVNode("",!0)]),a.createVNode(N,{label:"Ou URL do Avatar",help:"Link externo para imagem"},{default:a.withCtx(()=>[a.createVNode(k,{modelValue:a.unref(V).avatar_url,"onUpdate:modelValue":e=>a.unref(V).avatar_url=e,icon:"i-heroicons-photo",placeholder:"https://..."},null,8,["modelValue","onUpdate:modelValue"])]),_:1})])]),a.createVNode("div",{class:"grid gap-6"},[a.createVNode(N,{label:"Nome Completo",required:""},{default:a.withCtx(()=>[a.createVNode(k,{modelValue:a.unref(V).full_name,"onUpdate:modelValue":e=>a.unref(V).full_name=e,icon:"i-heroicons-identification"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a.createVNode(N,{label:"E-mail",help:"O e-mail não pode ser alterado."},{default:a.withCtx(()=>{var e;return[a.createVNode(k,{"model-value":null==(e=a.unref(g))?void 0:e.email,icon:"i-heroicons-envelope",disabled:"",color:"gray",variant:"filled"},null,8,["model-value"])]}),_:1})]),a.createVNode("div",{class:"flex justify-end pt-4"},[a.createVNode(b,{type:"submit",loading:a.unref(y),size:"lg"},{default:a.withCtx(()=>[a.createTextVNode(" Salvar Alterações ")]),_:1},8,["loading"])])],32)];r(`<form class="space-y-6"${t}><div class="flex flex-col items-center sm:flex-row gap-6 mb-6"${t}><div class="relative group cursor-pointer"${t}>`),r(f(h,{src:a.unref(V).avatar_url||(null==(i=null==(o=a.unref(g))?void 0:o.user_metadata)?void 0:i.avatar_url),alt:a.unref(V).full_name,size:"3xl",class:"ring-4 ring-gray-100 dark:ring-gray-800 transition-opacity group-hover:opacity-75"},null,l,t)),r(`<div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"${t}>`),r(f(v,{name:"i-heroicons-camera",class:"w-8 h-8 text-gray-800 dark:text-white drop-shadow-md"},null,l,t)),r("</div>"),a.unref(_)?(r(`<div class="absolute inset-0 bg-white/50 dark:bg-black/50 rounded-full flex items-center justify-center"${t}>`),r(f(v,{name:"i-heroicons-arrow-path",class:"w-8 h-8 animate-spin text-primary-500"},null,l,t)),r("</div>")):r("\x3c!----\x3e"),r(`</div><input type="file" class="hidden" accept="image/*"${t}><div class="flex-1 w-full space-y-4"${t}><div class="flex gap-2"${t}>`),r(f(b,{color:"white",icon:"i-heroicons-arrow-up-tray",loading:a.unref(_),onClick:triggerFileInput},{default:a.withCtx((e,r,l,t)=>{if(!r)return[a.createTextVNode(" Upload de Foto ")];r(" Upload de Foto ")}),_:1},l,t)),a.unref(V).avatar_url?r(f(b,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",onClick:e=>a.unref(V).avatar_url=""},null,l,t)):r("\x3c!----\x3e"),r("</div>"),r(f(N,{label:"Ou URL do Avatar",help:"Link externo para imagem"},{default:a.withCtx((e,r,l,t)=>{if(!r)return[a.createVNode(k,{modelValue:a.unref(V).avatar_url,"onUpdate:modelValue":e=>a.unref(V).avatar_url=e,icon:"i-heroicons-photo",placeholder:"https://..."},null,8,["modelValue","onUpdate:modelValue"])];r(f(k,{modelValue:a.unref(V).avatar_url,"onUpdate:modelValue":e=>a.unref(V).avatar_url=e,icon:"i-heroicons-photo",placeholder:"https://..."},null,l,t))}),_:1},l,t)),r(`</div></div><div class="grid gap-6"${t}>`),r(f(N,{label:"Nome Completo",required:""},{default:a.withCtx((e,r,l,t)=>{if(!r)return[a.createVNode(k,{modelValue:a.unref(V).full_name,"onUpdate:modelValue":e=>a.unref(V).full_name=e,icon:"i-heroicons-identification"},null,8,["modelValue","onUpdate:modelValue"])];r(f(k,{modelValue:a.unref(V).full_name,"onUpdate:modelValue":e=>a.unref(V).full_name=e,icon:"i-heroicons-identification"},null,l,t))}),_:1},l,t)),r(f(N,{label:"E-mail",help:"O e-mail não pode ser alterado."},{default:a.withCtx((e,r,l,t)=>{var o,i;if(!r)return[a.createVNode(k,{"model-value":null==(i=a.unref(g))?void 0:i.email,icon:"i-heroicons-envelope",disabled:"",color:"gray",variant:"filled"},null,8,["model-value"])];r(f(k,{"model-value":null==(o=a.unref(g))?void 0:o.email,icon:"i-heroicons-envelope",disabled:"",color:"gray",variant:"filled"},null,l,t))}),_:1},l,t)),r(`</div><div class="flex justify-end pt-4"${t}>`),r(f(b,{type:"submit",loading:a.unref(y),size:"lg"},{default:a.withCtx((e,r,l,t)=>{if(!r)return[a.createTextVNode(" Salvar Alterações ")];r(" Salvar Alterações ")}),_:1},l,t)),r("</div></form>")}),_:1},u)),l(f(p,null,{header:a.withCtx((e,r,l,t)=>{if(!r)return[a.createVNode("div",{class:"flex items-center gap-3"},[a.createVNode("div",{class:"p-2 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-500"},[a.createVNode(v,{name:"i-heroicons-adjustments-horizontal",class:"w-5 h-5"})]),a.createVNode("h3",{class:"font-semibold text-lg"},"Preferências")])];r(`<div class="flex items-center gap-3"${t}><div class="p-2 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-500"${t}>`),r(f(v,{name:"i-heroicons-adjustments-horizontal",class:"w-5 h-5"},null,l,t)),r(`</div><h3 class="font-semibold text-lg"${t}>Preferências</h3></div>`)}),default:a.withCtx((e,r,l,t)=>{if(!r)return[a.createVNode("div",{class:"flex items-center justify-between py-2"},[a.createVNode("div",{class:"flex flex-col"},[a.createVNode("span",{class:"font-medium"},"Tema Escuro"),a.createVNode("span",{class:"text-sm text-gray-500"},"Alternar entre modo claro e escuro.")]),a.createVNode(C,{size:"lg","model-value":"dark"===a.unref(x).value,"onUpdate:modelValue":toggleTheme},null,8,["model-value"])])];r(`<div class="flex items-center justify-between py-2"${t}><div class="flex flex-col"${t}><span class="font-medium"${t}>Tema Escuro</span><span class="text-sm text-gray-500"${t}>Alternar entre modo claro e escuro.</span></div>`),r(f(C,{size:"lg","model-value":"dark"===a.unref(x).value,"onUpdate:modelValue":toggleTheme},null,l,t)),r("</div>")}),_:1},u)),l("</div></div>")}}}),v=p.setup;p.setup=(e,r)=>{const l=a.useSSRContext();return(l.modules||(l.modules=new Set)).add("pages/settings.vue"),v?v(e,r):void 0};export{p as default};
//# sourceMappingURL=settings-CgBJUXgl.mjs.map
