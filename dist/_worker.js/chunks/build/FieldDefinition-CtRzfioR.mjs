import{_ as e}from"./Card-Bfh9rD5X.mjs";import{v as l,a,g as o,_ as t,e as r,c as i,m as s,h as d,i as n,t as u,j as c,k as p}from"./server.mjs";import{a as m,_ as f,u as v}from"./Input-CUCmPBr7.mjs";import{u as g}from"./useSupabaseClient-CktZlRub.mjs";import{a as b,b as x}from"./Select-PkSwbjSb.mjs";import{A as V,y as h,G as y,D as C,C as k,z as $,J as N,K as w,L as _}from"../routes/renderer.mjs";const S={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},U=s(n.ui.strategy,n.ui.radio,S),R=l.defineComponent({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>U.default.color,validator:e=>n.ui.colors.includes(e)},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:a}){var o;const{ui:t,attrs:r}=d("radio",l.toRef(e,"ui"),U,l.toRef(e,"class")),i=null!=(o=e.id)?o:l.useId(),s=l.inject("radio-group",null),{emitFormChange:n,color:p,name:m}=null!=s?s:v(e,U),f=l.computed({get:()=>e.modelValue,set(e){a("update:modelValue",e),s||n()}});const g=l.computed(()=>u(c(t.value.base,t.value.form,t.value.background,t.value.border,p.value&&t.value.ring.replaceAll("{color}",p.value),p.value&&t.value.color.replaceAll("{color}",p.value)),e.inputClass));return{inputId:i,ui:t,attrs:r,pick:f,name:m,inputClass:g,onChange:function(e){a("change",e.target.value)}}}});const A=R.setup;R.setup=(e,a)=>{const o=l.useSSRContext();return(o.modules||(o.modules=new Set)).add("node_modules/@nuxt/ui/dist/runtime/components/forms/Radio.vue"),A?A(e,a):void 0};const j=o(R,[["ssrRender",function(e,a,o,t,r,i,s,d){let n;a(`<div${V(l.mergeProps({class:e.ui.wrapper,"data-n-ids":e.attrs["data-n-ids"]},t))}><div class="${k(e.ui.container)}"><input${V((n=l.mergeProps({id:e.inputId,checked:N(e.pick,e.value),name:e.name,required:e.required,value:e.value,disabled:e.disabled,type:"radio",class:e.inputClass},e.attrs),l.mergeProps(n,w(n,e.pick))))}></div>`),e.label||e.$slots.label?(a(`<div class="${k(e.ui.inner)}"><label${_("for",e.inputId)} class="${k(e.ui.label)}">`),$(e.$slots,"label",{label:e.label},()=>{a(`${C(e.label)}`)},a,o),e.required?a(`<span class="${k(e.ui.required)}">*</span>`):a("\x3c!----\x3e"),a("</label>"),e.help||e.$slots.help?(a(`<p class="${k(e.ui.help)}">`),$(e.$slots,"help",{help:e.help},()=>{a(`${C(e.help)}`)},a,o),a("</p>")):a("\x3c!----\x3e"),a("</div>")):a("\x3c!----\x3e"),a("</div>")}]]),B=s(n.ui.strategy,n.ui.radioGroup,{wrapper:"relative flex items-start",fieldset:"",legend:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",default:{color:"primary"}}),O=s(n.ui.strategy,n.ui.radio,S),q=l.defineComponent({components:{URadio:j},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object,Boolean],default:""},name:{type:String,default:null},legend:{type:String,default:null},options:{type:Array,default:()=>[]},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},disabled:{type:Boolean,default:!1},color:{type:String,default:()=>B.default.color,validator:e=>n.ui.colors.includes(e)},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},uiRadio:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:a}){const{ui:o,attrs:t}=d("radioGroup",l.toRef(e,"ui"),B,l.toRef(e,"class")),{ui:r}=d("radio",l.toRef(e,"uiRadio"),O),{emitFormChange:i,color:s,name:n}=v(e,B,!1);l.provide("radio-group",{color:s,name:n});const guessOptionValue=l=>p(l,e.valueAttribute,p(l,e.optionAttribute)),guessOptionText=l=>p(l,e.optionAttribute,p(l,e.valueAttribute)),guessOptionSelected=l=>e.modelValue===guessOptionValue(l);return{ui:o,uiRadio:r,attrs:t,normalizedOptions:l.computed(()=>e.options.map(e=>(e=>["string","number","boolean"].includes(typeof e)?{value:e,label:e}:{...e,value:guessOptionValue(e),label:guessOptionText(e),selected:guessOptionSelected(e)})(e))),onUpdate:e=>{a("update:modelValue",e),a("change",e),i()}}}});const D=q.setup;q.setup=(e,a)=>{const o=l.useSSRContext();return(o.modules||(o.modules=new Set)).add("node_modules/@nuxt/ui/dist/runtime/components/forms/RadioGroup.vue"),D?D(e,a):void 0};const P=o(q,[["ssrRender",function(e,a,o,t,r,i,s,d){const n=j;a(`<div${V(l.mergeProps({class:e.ui.wrapper},t))}><fieldset${V(l.mergeProps(e.attrs,{class:e.ui.fieldset}))}>`),e.legend||e.$slots.legend?(a(`<legend class="${k(e.ui.legend)}">`),$(e.$slots,"legend",{},()=>{a(`${C(e.legend)}`)},a,o),a("</legend>")):a("\x3c!----\x3e"),a("\x3c!--[--\x3e"),y(e.normalizedOptions,t=>{a(h(n,{key:t.value,label:t.label,"model-value":e.modelValue,value:t.value,help:t.help,disabled:t.disabled||e.disabled,ui:e.uiRadio,onChange:l=>e.onUpdate(t.value)},l.createSlots({_:2},[e.$slots.label?{name:"label",fn:l.withCtx((a,o,r,i)=>{if(!o)return[l.renderSlot(e.$slots,"label",l.mergeProps({ref_for:!0},{option:t,selected:t.selected}))];$(e.$slots,"label",l.mergeProps({ref_for:!0},{option:t,selected:t.selected}),null,o,r,i)}),key:"0"}:void 0,e.$slots.help?{name:"help",fn:l.withCtx((a,o,r,i)=>{if(!o)return[l.renderSlot(e.$slots,"help",l.mergeProps({ref_for:!0},{option:t,selected:t.selected}))];$(e.$slots,"help",l.mergeProps({ref_for:!0},{option:t,selected:t.selected}),null,o,r,i)}),key:"1"}:void 0]),o))}),a("\x3c!--]--\x3e</fieldset></div>")}]]),I=l.defineComponent({__name:"CollectionAccessControl",__ssrInlineRender:!0,props:{modelValue:{},collectionId:{}},emits:["update:modelValue"],setup(o,{emit:i}){const s=o,d=i,n=g(),u=a(),c=l.computed({get:()=>s.modelValue,set:e=>d("update:modelValue",e)}),p=[{value:"private",label:"Privado (Apenas eu)"},{value:"shared",label:"Compartilhado (Usuários específicos)"},{value:"public",label:'Público (Qualquer pessoa pode ver na aba "Explorar")'}],f=l.ref(""),v=l.ref(!1),b=l.ref(!1),x=l.ref([]),loadShares=async()=>{if(!s.collectionId)return;const{data:e,error:l}=await n.from("collection_shares").select("id, user_id, profiles ( id, email, full_name, avatar_url )").eq("collection_id",s.collectionId);!l&&e&&(x.value=e)};l.watch(()=>s.collectionId,loadShares,{immediate:!0});const addUser=async()=>{if(f.value&&s.collectionId){b.value=!0;try{const{data:e,error:l}=await n.from("profiles").select("id").eq("email",f.value).single();if(l||!e)return void u.add({title:"Usuário não encontrado",description:"Nenhum usuário encontrado com este e-mail.",color:"red"});const{error:a}=await n.from("collection_shares").insert({collection_id:s.collectionId,user_id:e.id});if(a){if("23505"!==a.code)throw a;u.add({title:"Já compartilhado",description:"Usuário já tem acesso.",color:"orange"})}else u.add({title:"Adicionado",color:"green"}),f.value="",loadShares()}catch(e){u.add({title:"Erro",description:e.message,color:"red"})}finally{b.value=!1}}},removeUser=async e=>{if(!confirm("Remover acesso para este usuário?"))return;const{error:l}=await n.from("collection_shares").delete().eq("id",e);l?u.add({title:"Erro",description:l.message,color:"red"}):loadShares()};return(a,o,i,s)=>{const d=e,n=P,u=m,g=t,k=r;o(`<div${V(l.mergeProps({class:"space-y-6"},s))}>`),o(h(d,null,{header:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode("h3",{class:"font-semibold"},"Configurações de Visibilidade")];a(`<h3 class="font-semibold"${t}>Configurações de Visibilidade</h3>`)}),default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode("div",{class:"space-y-4"},[l.createVNode(n,{modelValue:l.unref(c),"onUpdate:modelValue":e=>l.isRef(c)?c.value=e:null,options:p,legend:"Quem pode ver esta coleção?"},null,8,["modelValue","onUpdate:modelValue"])])];a(`<div class="space-y-4"${t}>`),a(h(n,{modelValue:l.unref(c),"onUpdate:modelValue":e=>l.isRef(c)?c.value=e:null,options:p,legend:"Quem pode ver esta coleção?"},null,o,t)),a("</div>")}),_:1},i)),"shared"===l.unref(c)?o(h(d,null,{header:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode("h3",{class:"font-semibold"},"Compartilhado com")];a(`<h3 class="font-semibold"${t}>Compartilhado com</h3>`)}),default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode("div",{class:"space-y-4"},[l.createVNode("div",{class:"flex gap-2"},[l.createVNode(u,{modelValue:l.unref(f),"onUpdate:modelValue":e=>l.isRef(f)?f.value=e:null,placeholder:"Digite o e-mail do usuário...",class:"flex-1",loading:l.unref(v),onKeyup:l.withKeys(addUser,["enter"])},null,8,["modelValue","onUpdate:modelValue","loading"]),l.createVNode(g,{icon:"i-heroicons-paper-airplane",onClick:addUser,loading:l.unref(b)},{default:l.withCtx(()=>[l.createTextVNode("Adicionar")]),_:1},8,["loading"])]),0===l.unref(x).length?(l.openBlock(),l.createBlock("div",{key:0,class:"text-gray-500 text-sm italic"}," Não compartilhado com ninguém ainda. ")):(l.openBlock(),l.createBlock("div",{key:1,class:"space-y-2"},[(l.openBlock(!0),l.createBlock(l.Fragment,null,l.renderList(l.unref(x),e=>{var a,o,t,r;return l.openBlock(),l.createBlock("div",{key:e.id,class:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded"},[l.createVNode("div",{class:"flex items-center gap-2"},[l.createVNode(k,{src:null==(a=e.profiles)?void 0:a.avatar_url,alt:null==(o=e.profiles)?void 0:o.full_name,size:"xs"},null,8,["src","alt"]),l.createVNode("div",{class:"text-sm"},[l.createVNode("div",{class:"font-medium"},l.toDisplayString((null==(t=e.profiles)?void 0:t.full_name)||"Unknown"),1),l.createVNode("div",{class:"text-xs text-gray-500"},l.toDisplayString(null==(r=e.profiles)?void 0:r.email),1)])]),l.createVNode(g,{icon:"i-heroicons-trash",color:"red",variant:"ghost",size:"xs",onClick:l=>removeUser(e.id)},null,8,["onClick"])])}),128))]))])];a(`<div class="space-y-4"${t}><div class="flex gap-2"${t}>`),a(h(u,{modelValue:l.unref(f),"onUpdate:modelValue":e=>l.isRef(f)?f.value=e:null,placeholder:"Digite o e-mail do usuário...",class:"flex-1",loading:l.unref(v),onKeyup:addUser},null,o,t)),a(h(g,{icon:"i-heroicons-paper-airplane",onClick:addUser,loading:l.unref(b)},{default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createTextVNode("Adicionar")];a("Adicionar")}),_:1},o,t)),a("</div>"),0===l.unref(x).length?a(`<div class="text-gray-500 text-sm italic"${t}> Não compartilhado com ninguém ainda. </div>`):(a(`<div class="space-y-2"${t}>\x3c!--[--\x3e`),y(l.unref(x),e=>{var l,r,i,s;a(`<div class="flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded"${t}><div class="flex items-center gap-2"${t}>`),a(h(k,{src:null==(l=e.profiles)?void 0:l.avatar_url,alt:null==(r=e.profiles)?void 0:r.full_name,size:"xs"},null,o,t)),a(`<div class="text-sm"${t}><div class="font-medium"${t}>${C((null==(i=e.profiles)?void 0:i.full_name)||"Unknown")}</div><div class="text-xs text-gray-500"${t}>${C(null==(s=e.profiles)?void 0:s.email)}</div></div></div>`),a(h(g,{icon:"i-heroicons-trash",color:"red",variant:"ghost",size:"xs",onClick:l=>removeUser(e.id)},null,o,t)),a("</div>")}),a("\x3c!--]--\x3e</div>")),a("</div>")}),_:1},i)):o("\x3c!----\x3e"),o("</div>")}}}),z=I.setup;I.setup=(e,a)=>{const o=l.useSSRContext();return(o.modules||(o.modules=new Set)).add("components/CollectionAccessControl.vue"),z?z(e,a):void 0};const T=l.defineComponent({__name:"FieldDefinition",__ssrInlineRender:!0,props:{modelValue:{}},emits:["update:modelValue","remove"],setup(a,{emit:o}){const r=a,s=o,d=l.computed({get:()=>r.modelValue,set:e=>s("update:modelValue",e)}),n=l.ref(d.value.options?d.value.options.join(", "):""),u=[{label:"Texto Curto",value:"text"},{label:"Texto Longo",value:"textarea"},{label:"Número",value:"number"},{label:"Data",value:"date"},{label:"Sim/Não",value:"boolean"},{label:"Seleção (Dropdown)",value:"select"},{label:"Múltipla Seleção",value:"multiselect"}],updateOptions=()=>{n.value.trim()?d.value.options=n.value.split(",").map(e=>e.trim()).filter(Boolean):d.value.options=[]};return l.watch(()=>d.value.type,e=>{["select","multiselect"].includes(e)||(d.value.options=null,n.value="")}),(a,o,r,s)=>{const c=x,p=i,v=t,g=f,V=m,y=b;o(h(e,l.mergeProps({class:"mb-4 relative"},s),{header:l.withCtx((e,o,t,r)=>{if(!o)return[l.createVNode("div",{class:"flex justify-between items-center"},[l.createVNode("div",{class:"flex items-center gap-2"},[l.createVNode(c,{modelValue:l.unref(d).selected,"onUpdate:modelValue":e=>l.unref(d).selected=e},null,8,["modelValue","onUpdate:modelValue"]),l.createVNode(p,{name:"i-heroicons-bars-3",class:"cursor-move text-gray-400"}),l.createVNode("span",{class:"font-medium text-sm"},"Definição do Campo")]),l.createVNode(v,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",onClick:e=>a.$emit("remove")},null,8,["onClick"])])];o(`<div class="flex justify-between items-center"${r}><div class="flex items-center gap-2"${r}>`),o(h(c,{modelValue:l.unref(d).selected,"onUpdate:modelValue":e=>l.unref(d).selected=e},null,t,r)),o(h(p,{name:"i-heroicons-bars-3",class:"cursor-move text-gray-400"},null,t,r)),o(`<span class="font-medium text-sm"${r}>Definição do Campo</span></div>`),o(h(v,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",onClick:e=>a.$emit("remove")},null,t,r)),o("</div>")}),default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[l.createVNode(g,{label:"Nome do Campo",required:""},{default:l.withCtx(()=>[l.createVNode(V,{modelValue:l.unref(d).name,"onUpdate:modelValue":e=>l.unref(d).name=e,placeholder:"ex. Ano de Lançamento"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l.createVNode(g,{label:"Tipo do Campo",required:""},{default:l.withCtx(()=>[l.createVNode(y,{modelValue:l.unref(d).type,"onUpdate:modelValue":e=>l.unref(d).type=e,options:u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),["select","multiselect"].includes(l.unref(d).type)?(l.openBlock(),l.createBlock(g,{key:0,label:"Opções (separadas por vírgula)",class:"md:col-span-2",required:""},{help:l.withCtx(()=>[l.createVNode("span",{class:"text-xs text-gray-500"},"Digite as opções separadas por vírgula.")]),default:l.withCtx(()=>[l.createVNode(V,{modelValue:l.unref(n),"onUpdate:modelValue":e=>l.isRef(n)?n.value=e:null,placeholder:"Opção 1, Opção 2, Opção 3",onBlur:updateOptions},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):l.createCommentVNode("",!0),l.createVNode("div",{class:"flex items-center gap-4 mt-2"},[l.createVNode(c,{modelValue:l.unref(d).visible,"onUpdate:modelValue":e=>l.unref(d).visible=e,label:"Visível na Tabela"},null,8,["modelValue","onUpdate:modelValue"]),l.createVNode(c,{modelValue:l.unref(d).required,"onUpdate:modelValue":e=>l.unref(d).required=e,label:"Obrigatório",color:"red"},null,8,["modelValue","onUpdate:modelValue"])])])];a(`<div class="grid grid-cols-1 md:grid-cols-2 gap-4"${t}>`),a(h(g,{label:"Nome do Campo",required:""},{default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode(V,{modelValue:l.unref(d).name,"onUpdate:modelValue":e=>l.unref(d).name=e,placeholder:"ex. Ano de Lançamento"},null,8,["modelValue","onUpdate:modelValue"])];a(h(V,{modelValue:l.unref(d).name,"onUpdate:modelValue":e=>l.unref(d).name=e,placeholder:"ex. Ano de Lançamento"},null,o,t))}),_:1},o,t)),a(h(g,{label:"Tipo do Campo",required:""},{default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode(y,{modelValue:l.unref(d).type,"onUpdate:modelValue":e=>l.unref(d).type=e,options:u},null,8,["modelValue","onUpdate:modelValue"])];a(h(y,{modelValue:l.unref(d).type,"onUpdate:modelValue":e=>l.unref(d).type=e,options:u},null,o,t))}),_:1},o,t)),["select","multiselect"].includes(l.unref(d).type)?a(h(g,{label:"Opções (separadas por vírgula)",class:"md:col-span-2",required:""},{help:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode("span",{class:"text-xs text-gray-500"},"Digite as opções separadas por vírgula.")];a(`<span class="text-xs text-gray-500"${t}>Digite as opções separadas por vírgula.</span>`)}),default:l.withCtx((e,a,o,t)=>{if(!a)return[l.createVNode(V,{modelValue:l.unref(n),"onUpdate:modelValue":e=>l.isRef(n)?n.value=e:null,placeholder:"Opção 1, Opção 2, Opção 3",onBlur:updateOptions},null,8,["modelValue","onUpdate:modelValue"])];a(h(V,{modelValue:l.unref(n),"onUpdate:modelValue":e=>l.isRef(n)?n.value=e:null,placeholder:"Opção 1, Opção 2, Opção 3",onBlur:updateOptions},null,o,t))}),_:1},o,t)):a("\x3c!----\x3e"),a(`<div class="flex items-center gap-4 mt-2"${t}>`),a(h(c,{modelValue:l.unref(d).visible,"onUpdate:modelValue":e=>l.unref(d).visible=e,label:"Visível na Tabela"},null,o,t)),a(h(c,{modelValue:l.unref(d).required,"onUpdate:modelValue":e=>l.unref(d).required=e,label:"Obrigatório",color:"red"},null,o,t)),a("</div></div>")}),_:1},r))}}}),L=T.setup;T.setup=(e,a)=>{const o=l.useSSRContext();return(o.modules||(o.modules=new Set)).add("components/FieldDefinition.vue"),L?L(e,a):void 0};export{I as _,T as a};
//# sourceMappingURL=FieldDefinition-CtRzfioR.mjs.map
