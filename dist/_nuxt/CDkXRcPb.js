import{f as N,E as j,q as G,s as L,y as P,h as R,i as H,G as h,c as v,a,b as i,m as l,w as d,A as C,F as M,r as J,v as K,j as O,o as f,d as m,t as Q,n as E}from"./fMH9WF-P.js";import{_ as W,a as X}from"./B7Xsw2Wk.js";import{_ as Y,a as Z,b as ee}from"./Dr655yUR.js";import{_ as oe}from"./Ccg_Gj5U.js";import{u as te}from"./BbOMdhvK.js";import"./BF8qsuGU.js";const se={class:"max-w-3xl mx-auto p-4"},le={class:"flex items-center gap-4 mb-6"},ie={class:"space-y-4"},ae={class:"mb-6"},de={class:"flex flex-wrap gap-2 justify-between items-center mb-4 sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md py-4 border-b border-gray-200 dark:border-gray-800"},ne={class:"flex items-center gap-2"},re={key:0,class:"flex gap-2 ml-4"},ce={class:"space-y-4"},me={class:"flex justify-end gap-3 z-20 relative"},xe=N({__name:"edit",async setup(fe){let p,y;const n=j().params.id,c=G(),_=L(!1),o=P({name:"",description:"",visibility:"private",fields:[]}),{data:g,error:$}=([p,y]=R(()=>te(`/api/collections/${n}`,"$lvG1zHeC2p")),p=await p,y(),p);H(()=>{if(g.value){const t=g.value;o.name=t.name,o.description=t.description,o.visibility=t.visibility||"private",o.fields=(t.fields||[]).sort((e,s)=>e.folder_order-s.folder_order).map(e=>({...e,is_dynamic:!!e.is_dynamic,selected:!1}))}$.value&&(c.add({title:"Erro",description:"Não foi possível carregar a coleção",color:"red"}),E("/dashboard"))});const V=()=>{o.fields.push({tempId:Date.now(),name:"",type:"text",options:[],visible:!0,required:!1,selected:!1,is_dynamic:!1,folder_order:o.fields.length})},w=async t=>{const e=o.fields[t];if(e.id){if(!confirm(`Tem certeza que deseja excluir o campo "${e.name}"? Todos os dados deste campo serão perdidos!`))return;try{await $fetch(`/api/collections/${n}/fields/${e.id}`,{method:"DELETE"})}catch(s){c.add({title:"Erro",description:s.message,color:"red"});return}}o.fields.splice(t,1)},k=h(()=>o.fields.some(t=>t.selected)),F=h(()=>o.fields.filter(t=>t.selected).length),T=()=>{o.fields.forEach(t=>t.selected=!0)},z=()=>{o.fields.forEach(t=>t.selected=!1)},U=async()=>{const t=o.fields.filter(s=>s.selected);if(t.length===0||!confirm(`Excluir ${t.length} campos? Isso executará a ação imediatamente e não poderá ser desfeito.`))return;const e=t.map(s=>s.id).filter(s=>!!s);if(e.length>0)try{await Promise.all(e.map(s=>$fetch(`/api/collections/${n}/fields/${s}`,{method:"DELETE"})))}catch(s){c.add({title:"Erro",description:s.message,color:"red"});return}o.fields=o.fields.filter(s=>!s.selected),c.add({title:"Excluído",description:"Campos removidos",color:"green"})},D=async()=>{try{_.value=!0,await $fetch(`/api/collections/${n}`,{method:"PATCH",body:{name:o.name,description:o.description,visibility:o.visibility,fields:o.fields.map((t,e)=>({...t,folder_order:e}))}}),c.add({title:"Sucesso",description:"Coleção atualizada",color:"green"}),E(`/collections/${n}`)}catch(t){c.add({title:"Erro",description:t.message,color:"red"})}finally{_.value=!1}};return(t,e)=>{const s=O,A=X,b=W,S=Z,B=oe,q=Y,I=ee;return f(),v("div",se,[a("div",le,[i(s,{icon:"i-heroicons-arrow-left",variant:"ghost",to:`/collections/${l(n)}`},null,8,["to"]),e[3]||(e[3]=a("h1",{class:"text-2xl font-bold"},"Editar Coleção",-1))]),a("form",{onSubmit:K(D,["prevent"])},[i(B,{class:"mb-6"},{header:d(()=>[...e[4]||(e[4]=[a("h2",{class:"font-semibold"},"Detalhes Básicos",-1)])]),default:d(()=>[a("div",ie,[i(b,{label:"Nome da Coleção",required:""},{default:d(()=>[i(A,{modelValue:l(o).name,"onUpdate:modelValue":e[0]||(e[0]=r=>l(o).name=r),placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue"])]),_:1}),i(b,{label:"Descrição"},{default:d(()=>[i(S,{modelValue:l(o).description,"onUpdate:modelValue":e[1]||(e[1]=r=>l(o).description=r)},null,8,["modelValue"])]),_:1})])]),_:1}),i(q,{modelValue:l(o).visibility,"onUpdate:modelValue":e[2]||(e[2]=r=>l(o).visibility=r),"collection-id":l(n),class:"mb-6"},null,8,["modelValue","collection-id"]),a("div",ae,[a("div",de,[a("div",ne,[e[7]||(e[7]=a("h2",{class:"text-lg font-semibold"},"Campos Personalizados",-1)),l(k)?(f(),v("div",re,[i(s,{size:"xs",color:"red",variant:"soft",onClick:U},{default:d(()=>[m("Excluir Selecionados ("+Q(l(F))+")",1)]),_:1}),i(s,{size:"xs",color:"gray",variant:"ghost",onClick:z},{default:d(()=>[...e[5]||(e[5]=[m("Cancelar",-1)])]),_:1})])):(f(),C(s,{key:1,size:"xs",color:"gray",variant:"ghost",onClick:T},{default:d(()=>[...e[6]||(e[6]=[m("Selecionar Todos",-1)])]),_:1}))]),i(s,{size:"sm",icon:"i-heroicons-plus",onClick:V},{default:d(()=>[...e[8]||(e[8]=[m("Adicionar Campo",-1)])]),_:1})]),a("div",ce,[(f(!0),v(M,null,J(l(o).fields,(r,u)=>(f(),C(I,{key:r.tempId||r.id||u,modelValue:l(o).fields[u],"onUpdate:modelValue":x=>l(o).fields[u]=x,onRemove:x=>w(u)},null,8,["modelValue","onUpdate:modelValue","onRemove"]))),128))])]),a("div",me,[i(s,{to:`/collections/${l(n)}`,color:"gray",variant:"ghost"},{default:d(()=>[...e[9]||(e[9]=[m("Cancelar",-1)])]),_:1},8,["to"]),i(s,{type:"submit",loading:l(_)},{default:d(()=>[...e[10]||(e[10]=[m("Salvar Alterações",-1)])]),_:1},8,["loading"])])],32)])}}});export{xe as default};
