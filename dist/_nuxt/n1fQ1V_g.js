import{f as P,g as j,i as B,r as v,y as A,j as I,c as U,a,b as t,w as s,o as h,k as T,z as C,x as F,m as r,s as M,A as S,p as q,d as E}from"./BgoPae_m.js";import{_ as L,a as O}from"./BCpvTb5o.js";import{_ as D}from"./BSzSwfWJ.js";import{_ as G}from"./SPma5_lx.js";import{u as R}from"./BrtmVOS2.js";import{u as W}from"./D7SiiAYm.js";import"./BS-tlIyf.js";const H={class:"max-w-2xl mx-auto py-8"},J={class:"space-y-6"},K={class:"flex items-center gap-3"},Q={class:"p-2 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-primary-500"},X={class:"flex flex-col items-center sm:flex-row gap-6 mb-6"},Y={class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},Z={key:0,class:"absolute inset-0 bg-white/50 dark:bg-black/50 rounded-full flex items-center justify-center"},ee={class:"flex-1 w-full space-y-4"},ae={class:"flex gap-2"},te={class:"grid gap-6"},oe={class:"flex justify-end pt-4"},re={class:"flex items-center gap-3"},le={class:"p-2 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-500"},se={class:"flex items-center justify-between py-2"},_e=P({__name:"settings",setup(ne){const p=R(),n=j(),d=B(),x=W(),g=v(!1),o=A({full_name:"",avatar_url:""});I(()=>{n.value&&(o.full_name=n.value.user_metadata.full_name||"",o.avatar_url=n.value.user_metadata.avatar_url||"")});const V=i=>{x.preference=i?"dark":"light"},f=v(!1),y=v(null),b=()=>{y.value?.click()},z=async i=>{const e=i.target.files[0];if(!(!e||!n.value)){if(!e.type.startsWith("image/")){d.add({title:"Erro",description:"Por favor envie apenas imagens.",color:"red"});return}try{f.value=!0;const l=e.name.split(".").pop(),u=`profiles/${`${n.value.id}-${Date.now()}.${l}`}`,{error:c}=await p.storage.from("avatars").upload(u,e,{upsert:!0});if(c)throw c;const{data:{publicUrl:m}}=p.storage.from("avatars").getPublicUrl(u);o.avatar_url=m,d.add({title:"Upload concluído",color:"green"})}catch(l){l.message.includes("bucket not found")?d.add({title:"Erro de Configuração",description:'Bucket "avatars" não encontrado. Verifique o guia.',color:"red"}):d.add({title:"Erro no Upload",description:l.message,color:"red"})}finally{f.value=!1}}},$=async()=>{try{g.value=!0;const i={id:n.value?.id,full_name:o.full_name,avatar_url:o.avatar_url},{error:e}=await p.from("profiles").upsert(i);if(e)throw e;const{error:l}=await p.auth.updateUser({data:{full_name:o.full_name,avatar_url:o.avatar_url}});if(l)throw l;d.add({title:"Perfil atualizado",color:"green"})}catch(i){d.add({title:"Erro ao atualizar",description:i.message,color:"red"})}finally{g.value=!1}};return(i,e)=>{const l=M,w=F,u=q,c=O,m=L,k=D,N=G;return h(),U("div",H,[e[8]||(e[8]=a("div",{class:"flex items-center gap-4 mb-8"},[a("h1",{class:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent"},"Minha Conta")],-1)),a("div",J,[t(k,null,{header:s(()=>[a("div",K,[a("div",Q,[t(l,{name:"i-heroicons-user",class:"w-5 h-5"})]),e[3]||(e[3]=a("h3",{class:"font-semibold text-lg"},"Perfil",-1))])]),default:s(()=>[a("form",{onSubmit:T($,["prevent"]),class:"space-y-6"},[a("div",X,[a("div",{class:"relative group cursor-pointer",onClick:b},[t(w,{src:r(o).avatar_url||r(n)?.user_metadata?.avatar_url,alt:r(o).full_name,size:"3xl",class:"ring-4 ring-gray-100 dark:ring-gray-800 transition-opacity group-hover:opacity-75"},null,8,["src","alt"]),a("div",Y,[t(l,{name:"i-heroicons-camera",class:"w-8 h-8 text-gray-800 dark:text-white drop-shadow-md"})]),r(f)?(h(),U("div",Z,[t(l,{name:"i-heroicons-arrow-path",class:"w-8 h-8 animate-spin text-primary-500"})])):C("",!0)]),a("input",{ref_key:"fileInput",ref:y,type:"file",class:"hidden",accept:"image/*",onChange:z},null,544),a("div",ee,[a("div",ae,[t(u,{color:"white",icon:"i-heroicons-arrow-up-tray",loading:r(f),onClick:b},{default:s(()=>[...e[4]||(e[4]=[E(" Upload de Foto ",-1)])]),_:1},8,["loading"]),r(o).avatar_url?(h(),S(u,{key:0,color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",onClick:e[0]||(e[0]=_=>r(o).avatar_url="")})):C("",!0)]),t(m,{label:"Ou URL do Avatar",help:"Link externo para imagem"},{default:s(()=>[t(c,{modelValue:r(o).avatar_url,"onUpdate:modelValue":e[1]||(e[1]=_=>r(o).avatar_url=_),icon:"i-heroicons-photo",placeholder:"https://..."},null,8,["modelValue"])]),_:1})])]),a("div",te,[t(m,{label:"Nome Completo",required:""},{default:s(()=>[t(c,{modelValue:r(o).full_name,"onUpdate:modelValue":e[2]||(e[2]=_=>r(o).full_name=_),icon:"i-heroicons-identification"},null,8,["modelValue"])]),_:1}),t(m,{label:"E-mail",help:"O e-mail não pode ser alterado."},{default:s(()=>[t(c,{"model-value":r(n)?.email,icon:"i-heroicons-envelope",disabled:"",color:"gray",variant:"filled"},null,8,["model-value"])]),_:1})]),a("div",oe,[t(u,{type:"submit",loading:r(g),size:"lg"},{default:s(()=>[...e[5]||(e[5]=[E(" Salvar Alterações ",-1)])]),_:1},8,["loading"])])],32)]),_:1}),t(k,null,{header:s(()=>[a("div",re,[a("div",le,[t(l,{name:"i-heroicons-adjustments-horizontal",class:"w-5 h-5"})]),e[6]||(e[6]=a("h3",{class:"font-semibold text-lg"},"Preferências",-1))])]),default:s(()=>[a("div",se,[e[7]||(e[7]=a("div",{class:"flex flex-col"},[a("span",{class:"font-medium"},"Tema Escuro"),a("span",{class:"text-sm text-gray-500"},"Alternar entre modo claro e escuro.")],-1)),t(N,{size:"lg","model-value":r(x).value==="dark","onUpdate:modelValue":V},null,8,["model-value"])])]),_:1})])])}}});export{_e as default};
