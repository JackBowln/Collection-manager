import{f as B,T as I,i as A,r as N,y as j,z as R,n as C,E as h,c as g,a as d,b as r,m as l,w as a,D as w,F as M,v as P,k as G,p as L,o as _,d as f,t as H}from"./Duz5UmER.js";import{_ as J,a as K}from"./Bq_KpMDf.js";import{_ as O}from"./DmHzSPSE.js";import{_ as Q}from"./3hI37jxJ.js";import{_ as W,a as X}from"./5qaZQJI5.js";import{u as Y}from"./DSjrNHtu.js";const Z={class:"max-w-3xl mx-auto p-4"},ee={class:"flex items-center gap-4 mb-6"},oe={class:"space-y-4"},te={class:"mb-6"},se={class:"flex flex-wrap gap-2 justify-between items-center mb-4 sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md py-4 border-b border-gray-200 dark:border-gray-800"},ie={class:"flex items-center gap-2"},le={key:0,class:"flex gap-2 ml-4"},re={class:"space-y-4"},de={class:"flex justify-end gap-3 z-20 relative"},ve=B({__name:"edit",setup(ae){const c=I().params.id,m=Y(),p=A(),b=N(!1),t=j({name:"",description:"",visibility:"private",fields:[]});R(async()=>{const{data:i,error:o}=await m.from("collections").select("*, fields (*)").eq("id",c).single();if(o){p.add({title:"Error",description:"Could not load collection",color:"red"}),C("/dashboard");return}t.name=i.name,t.description=i.description,t.visibility=i.visibility||"private",t.fields=(i.fields||[]).sort((s,u)=>s.folder_order-u.folder_order).map(s=>({...s,selected:!1}))});const V=()=>{t.fields.push({tempId:Date.now(),name:"",type:"text",options:[],visible:!0,required:!1,selected:!1,folder_order:t.fields.length})},k=async i=>{const o=t.fields[i];if(o.id){if(!confirm(`Tem certeza que deseja excluir o campo "${o.name}"? Todos os dados deste campo serão perdidos!`))return;const{error:s}=await m.from("fields").delete().eq("id",o.id);if(s){p.add({title:"Erro",description:s.message,color:"red"});return}}t.fields.splice(i,1)},E=h(()=>t.fields.some(i=>i.selected)),q=h(()=>t.fields.filter(i=>i.selected).length),F=()=>{t.fields.forEach(i=>i.selected=!0)},T=()=>{t.fields.forEach(i=>i.selected=!1)},U=async()=>{const i=t.fields.filter(s=>s.selected);if(i.length===0||!confirm(`Excluir ${i.length} campos? Isso executará a ação imediatamente e não poderá ser desfeito.`))return;const o=i.map(s=>s.id).filter(s=>!!s);if(o.length>0){const{error:s}=await m.from("fields").delete().in("id",o);if(s){p.add({title:"Erro",description:s.message,color:"red"});return}}t.fields=t.fields.filter(s=>!s.selected),p.add({title:"Excluído",description:"Campos removidos",color:"green"})},z=async()=>{try{b.value=!0;const{error:i}=await m.from("collections").update({name:t.name,description:t.description,visibility:t.visibility}).eq("id",c);if(i)throw i;const o=t.fields.map((e,y)=>({...e,collection_id:c,folder_order:y,name:e.name,type:e.type,options:e.options,visible:e.visible,required:e.required||!1})),s=o.filter(e=>e.id).map(e=>({id:e.id,collection_id:e.collection_id,name:e.name,type:e.type,options:e.options,visible:e.visible,required:e.required,folder_order:e.folder_order})),u=o.filter(e=>!e.id).map(e=>({collection_id:e.collection_id,name:e.name,type:e.type,options:e.options,visible:e.visible,required:e.required,folder_order:e.folder_order}));if(s.length>0){const{error:e}=await m.from("fields").upsert(s);if(e)throw e}if(u.length>0){const{error:e}=await m.from("fields").insert(u);if(e)throw e}p.add({title:"Sucesso",description:"Coleção atualizada",color:"green"}),C(`/collections/${c}`)}catch(i){p.add({title:"Erro",description:i.message,color:"red"})}finally{b.value=!1}};return(i,o)=>{const s=L,u=K,e=J,y=O,S=Q,$=W,D=X;return _(),g("div",Z,[d("div",ee,[r(s,{icon:"i-heroicons-arrow-left",variant:"ghost",to:`/collections/${l(c)}`},null,8,["to"]),o[3]||(o[3]=d("h1",{class:"text-2xl font-bold"},"Editar Coleção",-1))]),d("form",{onSubmit:G(z,["prevent"])},[r(S,{class:"mb-6"},{header:a(()=>[...o[4]||(o[4]=[d("h2",{class:"font-semibold"},"Detalhes Básicos",-1)])]),default:a(()=>[d("div",oe,[r(e,{label:"Nome da Coleção",required:""},{default:a(()=>[r(u,{modelValue:l(t).name,"onUpdate:modelValue":o[0]||(o[0]=n=>l(t).name=n),placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue"])]),_:1}),r(e,{label:"Descrição"},{default:a(()=>[r(y,{modelValue:l(t).description,"onUpdate:modelValue":o[1]||(o[1]=n=>l(t).description=n)},null,8,["modelValue"])]),_:1})])]),_:1}),r($,{modelValue:l(t).visibility,"onUpdate:modelValue":o[2]||(o[2]=n=>l(t).visibility=n),"collection-id":l(c),class:"mb-6"},null,8,["modelValue","collection-id"]),d("div",te,[d("div",se,[d("div",ie,[o[7]||(o[7]=d("h2",{class:"text-lg font-semibold"},"Campos Personalizados",-1)),l(E)?(_(),g("div",le,[r(s,{size:"xs",color:"red",variant:"soft",onClick:U},{default:a(()=>[f("Excluir Selecionados ("+H(l(q))+")",1)]),_:1}),r(s,{size:"xs",color:"gray",variant:"ghost",onClick:T},{default:a(()=>[...o[5]||(o[5]=[f("Cancelar",-1)])]),_:1})])):(_(),w(s,{key:1,size:"xs",color:"gray",variant:"ghost",onClick:F},{default:a(()=>[...o[6]||(o[6]=[f("Selecionar Todos",-1)])]),_:1}))]),r(s,{size:"sm",icon:"i-heroicons-plus",onClick:V},{default:a(()=>[...o[8]||(o[8]=[f("Adicionar Campo",-1)])]),_:1})]),d("div",re,[(_(!0),g(M,null,P(l(t).fields,(n,v)=>(_(),w(D,{key:n.tempId||n.id||v,modelValue:l(t).fields[v],"onUpdate:modelValue":x=>l(t).fields[v]=x,onRemove:x=>k(v)},null,8,["modelValue","onUpdate:modelValue","onRemove"]))),128))])]),d("div",de,[r(s,{to:`/collections/${l(c)}`,color:"gray",variant:"ghost"},{default:a(()=>[...o[9]||(o[9]=[f("Cancelar",-1)])]),_:1},8,["to"]),r(s,{type:"submit",loading:l(b)},{default:a(()=>[...o[10]||(o[10]=[f("Salvar Alterações",-1)])]),_:1},8,["loading"])])],32)])}}});export{ve as default};
