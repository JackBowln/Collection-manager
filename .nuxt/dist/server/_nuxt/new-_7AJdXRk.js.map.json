{"file":"new-_7AJdXRk.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_ssrRenderComponent","_push","_parent","_createVNode","_","_scopeId","_unref","_ssrRenderList"],"sources":["../../../../pages/collections/new.vue"],"sourcesContent":["<template>\r\n  <div class=\"max-w-3xl mx-auto p-4\">\r\n    <div class=\"flex items-center gap-4 mb-6\">\r\n      <UButton icon=\"i-heroicons-arrow-left\" variant=\"ghost\" to=\"/dashboard\" />\r\n      <h1 class=\"text-2xl font-bold\">Criar Nova Coleção</h1>\r\n    </div>\r\n\r\n    <form @submit.prevent=\"saveCollection\">\r\n      <UCard class=\"mb-6\">\r\n        <template #header>\r\n          <h2 class=\"font-semibold\">Detalhes Básicos</h2>\r\n        </template>\r\n        <div class=\"space-y-4\">\r\n          <UFormGroup label=\"Nome da Coleção\" required>\r\n            <UInput v-model=\"form.name\" placeholder=\"ex. Discos de Vinil\" required />\r\n          </UFormGroup>\r\n          <UFormGroup label=\"Descrição\">\r\n            <UTextarea v-model=\"form.description\" placeholder=\"Uma coleção dos meus discos raros...\" />\r\n          </UFormGroup>\r\n        </div>\r\n      </UCard>\r\n\r\n      <CollectionAccessControl v-model=\"form.visibility\" class=\"mb-6\" />\r\n\r\n      <div class=\"relative mb-6\">\r\n        <div ref=\"sentinel\" class=\"absolute -top-1 left-0 right-0 h-1 pointer-events-none\" />\r\n        <div \r\n          class=\"flex justify-between items-center mb-4 sticky top-0 z-10 py-4 transition-all duration-300 dark:bg-transparent\"\r\n          :class=\"[isSticky ? 'backdrop-blur-md border-b border-gray-200 dark:border-gray-800' : 'border-transparent']\"\r\n        >\r\n          <h2 class=\"text-lg font-semibold\">Campos Personalizados</h2>\r\n          <UButton size=\"sm\" icon=\"i-heroicons-plus\" @click=\"addField\">Adicionar Campo</UButton>\r\n        </div>\r\n\r\n        <div v-if=\"form.fields.length === 0\" class=\"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg\">\r\n          <p class=\"text-gray-500\">Nenhum campo definido. Adicione campos para estruturar sua coleção.</p>\r\n        </div>\r\n\r\n        <div class=\"space-y-4\">\r\n          <FieldDefinition\r\n            v-for=\"(field, index) in form.fields\"\r\n            :key=\"index\"\r\n            v-model=\"form.fields[index]\"\r\n            @remove=\"removeField(index)\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"flex justify-end gap-3\">\r\n        <UButton to=\"/dashboard\" color=\"gray\" variant=\"ghost\">Cancelar</UButton>\r\n        <UButton type=\"submit\" :loading=\"loading\">Criar Coleção</UButton>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nconst supabase = useSupabaseClient()\r\nconst user = useSupabaseUser()\r\nconst toast = useToast()\r\n\r\nconst loading = ref(false)\r\n\r\nconst form = reactive({\r\n  name: '',\r\n  description: '',\r\n  visibility: 'private' as 'private' | 'shared' | 'public',\r\n  fields: [] as any[]\r\n})\r\n\r\nconst addField = () => {\r\n  form.fields.push({\r\n    name: '',\r\n    type: 'text',\r\n    options: [],\r\n    visible: true,\r\n    required: false,\r\n    folder_order: form.fields.length\r\n  })\r\n}\r\n\r\nconst removeField = (index: number) => {\r\n  form.fields.splice(index, 1)\r\n}\r\n\r\nconst saveCollection = async () => {\r\n  if (!user.value) return\r\n  if (form.fields.length === 0 && !confirm('Criar coleção sem nenhum campo personalizado?')) return\r\n\r\n  try {\r\n    loading.value = true\r\n    \r\n    // 1. Create Collection\r\n    const { data: collection, error: collectionError } = await supabase\r\n      .from('collections')\r\n      .insert({\r\n        user_id: user.value.id,\r\n        name: form.name,\r\n        description: form.description,\r\n        visibility: form.visibility\r\n      })\r\n      .select()\r\n      .single()\r\n    \r\n    if (collectionError) throw collectionError\r\n\r\n    if (form.fields.length > 0) {\r\n      // 2. Create Fields\r\n      const fieldsToInsert = form.fields.map((f, index) => ({\r\n        collection_id: collection.id,\r\n        name: f.name,\r\n        type: f.type,\r\n        options: f.options && f.options.length ? f.options : null,\r\n        visible: f.visible,\r\n        required: f.required,\r\n        folder_order: index\r\n      }))\r\n\r\n      const { error: fieldsError } = await supabase\r\n        .from('fields')\r\n        .insert(fieldsToInsert)\r\n      \r\n      if (fieldsError) throw fieldsError // Ideally rollback collection here but keeping it simple\r\n    }\r\n\r\n    toast.add({ title: 'Sucesso', description: 'Coleção criada com sucesso', color: 'green' })\r\n    navigateTo('/dashboard')\r\n\r\n  } catch (error: any) {\r\n    toast.add({ title: 'Erro', description: error.message, color: 'red' })\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// Sticky header logic\r\nconst isSticky = ref(false)\r\nconst sentinel = ref<HTMLElement | null>(null)\r\n\r\nonMounted(() => {\r\n  const observer = new IntersectionObserver(([entry]) => {\r\n    isSticky.value = !entry.isIntersecting && entry.boundingClientRect.top < 0\r\n  }, { threshold: 1.0 })\r\n  \r\n  if (sentinel.value) observer.observe(sentinel.value)\r\n})\r\n\r\nonUnmounted(() => {\r\n  // Ideally we store observer in a variable or use a composable, but since we are in setup(), just relying on standard lifecycle is cleaner.\r\n})\r\n</script>\r\n"],"version":3}