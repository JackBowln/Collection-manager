import{_ as M,f as D,c as y,o as f,a as u,B as w,U as te,V as oe,W as j,C,X as x,d as N,t as q,Y as T,Z as F,P as A,$ as se,L as ne,E as I,a0 as re,a1 as ie,a2 as U,F as J,v as K,D as R,a3 as de,w as b,a4 as B,a5 as ue,i as ce,r as O,q as Q,b as m,m as d,l as G,a6 as pe,p as W,x as me,s as fe}from"./Duz5UmER.js";import{u as X,a as Y,_ as ge}from"./Bq_KpMDf.js";import{_ as Z}from"./3hI37jxJ.js";import{u as ve}from"./DSjrNHtu.js";import{a as be,b as ye}from"./DmHzSPSE.js";const _e={wrapper:"relative flex items-start",fieldset:"",legend:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",default:{color:"primary"}},H={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},z=T(U.ui.strategy,U.ui.radio,H),he=D({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>z.default.color,validator(e){return U.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:g}){const{ui:s,attrs:k}=F("radio",A(e,"ui"),z,A(e,"class")),l=e.id??se(),n=ne("radio-group",null),{emitFormChange:p,color:o,name:r}=n??X(e,z),t=I({get(){return e.modelValue},set(h){g("update:modelValue",h),n||p()}});function _(h){g("change",h.target.value)}const $=I(()=>re(ie(s.value.base,s.value.form,s.value.background,s.value.border,o.value&&s.value.ring.replaceAll("{color}",o.value),o.value&&s.value.color.replaceAll("{color}",o.value)),e.inputClass));return{inputId:l,ui:s,attrs:k,pick:t,name:r,inputClass:$,onChange:_}}}),Ve=["data-n-ids"],ke=["id","name","required","value","disabled"],$e=["for"];function Ce(e,g,s,k,l,n){return f(),y("div",{class:C(e.ui.wrapper),"data-n-ids":e.attrs["data-n-ids"]},[u("div",{class:C(e.ui.container)},[te(u("input",j({id:e.inputId,"onUpdate:modelValue":g[0]||(g[0]=p=>e.pick=p),name:e.name,required:e.required,value:e.value,disabled:e.disabled,type:"radio",class:e.inputClass},e.attrs,{onChange:g[1]||(g[1]=(...p)=>e.onChange&&e.onChange(...p))}),null,16,ke),[[oe,e.pick]])],2),e.label||e.$slots.label?(f(),y("div",{key:0,class:C(e.ui.inner)},[u("label",{for:e.inputId,class:C(e.ui.label)},[x(e.$slots,"label",{label:e.label},()=>[N(q(e.label),1)]),e.required?(f(),y("span",{key:0,class:C(e.ui.required)},"*",2)):w("",!0)],10,$e),e.help||e.$slots.help?(f(),y("p",{key:0,class:C(e.ui.help)},[x(e.$slots,"help",{help:e.help},()=>[N(q(e.help),1)])],2)):w("",!0)],2)):w("",!0)],10,Ve)}const ee=M(he,[["render",Ce]]),E=T(U.ui.strategy,U.ui.radioGroup,_e),Ue=T(U.ui.strategy,U.ui.radio,H),Se=D({components:{URadio:ee},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object,Boolean],default:""},name:{type:String,default:null},legend:{type:String,default:null},options:{type:Array,default:()=>[]},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},disabled:{type:Boolean,default:!1},color:{type:String,default:()=>E.default.color,validator(e){return U.ui.colors.includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},uiRadio:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:g}){const{ui:s,attrs:k}=F("radioGroup",A(e,"ui"),E,A(e,"class")),{ui:l}=F("radio",A(e,"uiRadio"),Ue),{emitFormChange:n,color:p,name:o}=X(e,E,!1);ue("radio-group",{color:p,name:o});const r=a=>{g("update:modelValue",a),g("change",a),n()},t=a=>B(a,e.valueAttribute,B(a,e.optionAttribute)),_=a=>B(a,e.optionAttribute,B(a,e.valueAttribute)),$=a=>e.modelValue===t(a),h=a=>["string","number","boolean"].includes(typeof a)?{value:a,label:a}:{...a,value:t(a),label:_(a),selected:$(a)},S=I(()=>e.options.map(a=>h(a)));return{ui:s,uiRadio:l,attrs:k,normalizedOptions:S,onUpdate:r}}});function we(e,g,s,k,l,n){const p=ee;return f(),y("div",{class:C(e.ui.wrapper)},[u("fieldset",j(e.attrs,{class:e.ui.fieldset}),[e.legend||e.$slots.legend?(f(),y("legend",{key:0,class:C(e.ui.legend)},[x(e.$slots,"legend",{},()=>[N(q(e.legend),1)])],2)):w("",!0),(f(!0),y(J,null,K(e.normalizedOptions,o=>(f(),R(p,{key:o.value,label:o.label,"model-value":e.modelValue,value:o.value,help:o.help,disabled:o.disabled||e.disabled,ui:e.uiRadio,onChange:r=>e.onUpdate(o.value)},de({_:2},[e.$slots.label?{name:"label",fn:b(()=>[x(e.$slots,"label",j({ref_for:!0},{option:o,selected:o.selected}))]),key:"0"}:void 0,e.$slots.help?{name:"help",fn:b(()=>[x(e.$slots,"help",j({ref_for:!0},{option:o,selected:o.selected}))]),key:"1"}:void 0]),1032,["label","model-value","value","help","disabled","ui","onChange"]))),128))],16)],2)}const Oe=M(Se,[["render",we]]),xe={class:"space-y-6"},Ae={class:"space-y-4"},qe={class:"space-y-4"},Ie={class:"flex gap-2"},Be={key:0,class:"text-gray-500 text-sm italic"},je={key:1,class:"space-y-2"},Ne={class:"flex items-center gap-2"},Re={class:"text-sm"},De={class:"font-medium"},ze={class:"text-xs text-gray-500"},We=D({__name:"CollectionAccessControl",props:{modelValue:{},collectionId:{}},emits:["update:modelValue"],setup(e,{emit:g}){const s=e,k=g,l=ve(),n=ce(),p=I({get:()=>s.modelValue,set:v=>k("update:modelValue",v)}),o=[{value:"private",label:"Privado (Apenas eu)"},{value:"shared",label:"Compartilhado (Usuários específicos)"},{value:"public",label:'Público (Qualquer pessoa pode ver na aba "Explorar")'}],r=O(""),t=O(!1),_=O(!1),$=O([]),h=async()=>{if(!s.collectionId)return;const{data:v,error:i}=await l.from("collection_shares").select("id, user_id, profiles ( id, email, full_name, avatar_url )").eq("collection_id",s.collectionId);!i&&v&&($.value=v)};Q(()=>s.collectionId,h,{immediate:!0});const S=async()=>{if(!(!r.value||!s.collectionId)){_.value=!0;try{const{data:v,error:i}=await l.from("profiles").select("id").eq("email",r.value).single();if(i||!v){n.add({title:"Usuário não encontrado",description:"Nenhum usuário encontrado com este e-mail.",color:"red"});return}const{error:c}=await l.from("collection_shares").insert({collection_id:s.collectionId,user_id:v.id});if(c)if(c.code==="23505")n.add({title:"Já compartilhado",description:"Usuário já tem acesso.",color:"orange"});else throw c;else n.add({title:"Adicionado",color:"green"}),r.value="",h()}catch(v){n.add({title:"Erro",description:v.message,color:"red"})}finally{_.value=!1}}},a=async v=>{if(!confirm("Remover acesso para este usuário?"))return;const{error:i}=await l.from("collection_shares").delete().eq("id",v);i?n.add({title:"Erro",description:i.message,color:"red"}):h()};return(v,i)=>{const c=Oe,L=Z,le=Y,P=W,ae=me;return f(),y("div",xe,[m(L,null,{header:b(()=>[...i[2]||(i[2]=[u("h3",{class:"font-semibold"},"Configurações de Visibilidade",-1)])]),default:b(()=>[u("div",Ae,[m(c,{modelValue:d(p),"onUpdate:modelValue":i[0]||(i[0]=V=>G(p)?p.value=V:null),options:o,legend:"Quem pode ver esta coleção?"},null,8,["modelValue"])])]),_:1}),d(p)==="shared"?(f(),R(L,{key:0},{header:b(()=>[...i[3]||(i[3]=[u("h3",{class:"font-semibold"},"Compartilhado com",-1)])]),default:b(()=>[u("div",qe,[u("div",Ie,[m(le,{modelValue:d(r),"onUpdate:modelValue":i[1]||(i[1]=V=>G(r)?r.value=V:null),placeholder:"Digite o e-mail do usuário...",class:"flex-1",loading:d(t),onKeyup:pe(S,["enter"])},null,8,["modelValue","loading"]),m(P,{icon:"i-heroicons-paper-airplane",onClick:S,loading:d(_)},{default:b(()=>[...i[4]||(i[4]=[N("Adicionar",-1)])]),_:1},8,["loading"])]),d($).length===0?(f(),y("div",Be," Não compartilhado com ninguém ainda. ")):(f(),y("div",je,[(f(!0),y(J,null,K(d($),V=>(f(),y("div",{key:V.id,class:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded"},[u("div",Ne,[m(ae,{src:V.profiles?.avatar_url,alt:V.profiles?.full_name,size:"xs"},null,8,["src","alt"]),u("div",Re,[u("div",De,q(V.profiles?.full_name||"Unknown"),1),u("div",ze,q(V.profiles?.email),1)])]),m(P,{icon:"i-heroicons-trash",color:"red",variant:"ghost",size:"xs",onClick:Le=>a(V.id)},null,8,["onClick"])]))),128))]))])]),_:1})):w("",!0)])}}}),Ee={class:"flex justify-between items-center"},Fe={class:"flex items-center gap-2"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te={class:"flex items-center gap-4 mt-2"},Xe=D({__name:"FieldDefinition",props:{modelValue:{}},emits:["update:modelValue","remove"],setup(e,{emit:g}){const s=e,k=g,l=I({get:()=>s.modelValue,set:r=>k("update:modelValue",r)}),n=O(l.value.options?l.value.options.join(", "):""),p=[{label:"Texto Curto",value:"text"},{label:"Texto Longo",value:"textarea"},{label:"Número",value:"number"},{label:"Data",value:"date"},{label:"Sim/Não",value:"boolean"},{label:"Seleção (Dropdown)",value:"select"},{label:"Múltipla Seleção",value:"multiselect"}],o=()=>{n.value.trim()?l.value.options=n.value.split(",").map(r=>r.trim()).filter(Boolean):l.value.options=[]};return Q(()=>l.value.type,r=>{["select","multiselect"].includes(r)||(l.value.options=null,n.value="")}),(r,t)=>{const _=ye,$=fe,h=W,S=Y,a=ge,v=be,i=Z;return f(),R(i,{class:"mb-4 relative"},{header:b(()=>[u("div",Ee,[u("div",Fe,[m(_,{modelValue:d(l).selected,"onUpdate:modelValue":t[0]||(t[0]=c=>d(l).selected=c)},null,8,["modelValue"]),m($,{name:"i-heroicons-bars-3",class:"cursor-move text-gray-400"}),t[7]||(t[7]=u("span",{class:"font-medium text-sm"},"Definição do Campo",-1))]),m(h,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",onClick:t[1]||(t[1]=c=>r.$emit("remove"))})])]),default:b(()=>[u("div",Ge,[m(a,{label:"Nome do Campo",required:""},{default:b(()=>[m(S,{modelValue:d(l).name,"onUpdate:modelValue":t[2]||(t[2]=c=>d(l).name=c),placeholder:"ex. Ano de Lançamento"},null,8,["modelValue"])]),_:1}),m(a,{label:"Tipo do Campo",required:""},{default:b(()=>[m(v,{modelValue:d(l).type,"onUpdate:modelValue":t[3]||(t[3]=c=>d(l).type=c),options:p},null,8,["modelValue"])]),_:1}),["select","multiselect"].includes(d(l).type)?(f(),R(a,{key:0,label:"Opções (separadas por vírgula)",class:"md:col-span-2",required:""},{help:b(()=>[...t[8]||(t[8]=[u("span",{class:"text-xs text-gray-500"},"Digite as opções separadas por vírgula.",-1)])]),default:b(()=>[m(S,{modelValue:d(n),"onUpdate:modelValue":t[4]||(t[4]=c=>G(n)?n.value=c:null),placeholder:"Opção 1, Opção 2, Opção 3",onBlur:o},null,8,["modelValue"])]),_:1})):w("",!0),u("div",Te,[m(_,{modelValue:d(l).visible,"onUpdate:modelValue":t[5]||(t[5]=c=>d(l).visible=c),label:"Visível na Tabela"},null,8,["modelValue"]),m(_,{modelValue:d(l).required,"onUpdate:modelValue":t[6]||(t[6]=c=>d(l).required=c),label:"Obrigatório",color:"red"},null,8,["modelValue"])])])]),_:1})}}});export{We as _,Xe as a};
