import{f as F,g as q,i as D,r as b,y as S,z as T,A,c as v,a as s,b as r,w as i,m as t,B as E,C as I,F as $,v as R,k as j,p as M,o as u,d as g,D as G,n as L}from"./Duz5UmER.js";import{_ as O,a as P}from"./Bq_KpMDf.js";import{_ as H}from"./DmHzSPSE.js";import{_ as J}from"./3hI37jxJ.js";import{_ as K,a as Q}from"./5qaZQJI5.js";import{u as W}from"./DSjrNHtu.js";const X={class:"max-w-3xl mx-auto p-4"},Y={class:"flex items-center gap-4 mb-6"},Z={class:"space-y-4"},ee={class:"relative mb-6"},oe={key:0,class:"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg"},se={class:"space-y-4"},te={class:"flex justify-end gap-3"},me=F({__name:"new",setup(ne){const y=W(),C=q(),h=D(),p=b(!1),o=S({name:"",description:"",visibility:"private",fields:[]}),k=()=>{o.fields.push({name:"",type:"text",options:[],visible:!0,required:!1,folder_order:o.fields.length})},U=a=>{o.fields.splice(a,1)},w=async()=>{if(C.value&&!(o.fields.length===0&&!confirm("Criar coleção sem nenhum campo personalizado?")))try{p.value=!0;const{data:a,error:e}=await y.from("collections").insert({user_id:C.value.id,name:o.name,description:o.description,visibility:o.visibility}).select().single();if(e)throw e;if(o.fields.length>0){const l=o.fields.map((n,_)=>({collection_id:a.id,name:n.name,type:n.type,options:n.options&&n.options.length?n.options:null,visible:n.visible,required:n.required,folder_order:_})),{error:c}=await y.from("fields").insert(l);if(c)throw c}h.add({title:"Sucesso",description:"Coleção criada com sucesso",color:"green"}),L("/dashboard")}catch(a){h.add({title:"Erro",description:a.message,color:"red"})}finally{p.value=!1}},x=b(!1),f=b(null);return T(()=>{const a=new IntersectionObserver(([e])=>{x.value=!e.isIntersecting&&e.boundingClientRect.top<0},{threshold:1});f.value&&a.observe(f.value)}),A(()=>{}),(a,e)=>{const l=M,c=P,n=O,_=H,B=J,N=K,z=Q;return u(),v("div",X,[s("div",Y,[r(l,{icon:"i-heroicons-arrow-left",variant:"ghost",to:"/dashboard"}),e[3]||(e[3]=s("h1",{class:"text-2xl font-bold"},"Criar Nova Coleção",-1))]),s("form",{onSubmit:j(w,["prevent"])},[r(B,{class:"mb-6"},{header:i(()=>[...e[4]||(e[4]=[s("h2",{class:"font-semibold"},"Detalhes Básicos",-1)])]),default:i(()=>[s("div",Z,[r(n,{label:"Nome da Coleção",required:""},{default:i(()=>[r(c,{modelValue:t(o).name,"onUpdate:modelValue":e[0]||(e[0]=d=>t(o).name=d),placeholder:"ex. Discos de Vinil",required:""},null,8,["modelValue"])]),_:1}),r(n,{label:"Descrição"},{default:i(()=>[r(_,{modelValue:t(o).description,"onUpdate:modelValue":e[1]||(e[1]=d=>t(o).description=d),placeholder:"Uma coleção dos meus discos raros..."},null,8,["modelValue"])]),_:1})])]),_:1}),r(N,{modelValue:t(o).visibility,"onUpdate:modelValue":e[2]||(e[2]=d=>t(o).visibility=d),class:"mb-6"},null,8,["modelValue"]),s("div",ee,[s("div",{ref_key:"sentinel",ref:f,class:"absolute -top-1 left-0 right-0 h-1 pointer-events-none"},null,512),s("div",{class:I(["flex justify-between items-center mb-4 sticky top-0 z-10 py-4 transition-all duration-300 dark:bg-transparent",[t(x)?"backdrop-blur-md border-b border-gray-200 dark:border-gray-800":"border-transparent"]])},[e[6]||(e[6]=s("h2",{class:"text-lg font-semibold"},"Campos Personalizados",-1)),r(l,{size:"sm",icon:"i-heroicons-plus",onClick:k},{default:i(()=>[...e[5]||(e[5]=[g("Adicionar Campo",-1)])]),_:1})],2),t(o).fields.length===0?(u(),v("div",oe,[...e[7]||(e[7]=[s("p",{class:"text-gray-500"},"Nenhum campo definido. Adicione campos para estruturar sua coleção.",-1)])])):E("",!0),s("div",se,[(u(!0),v($,null,R(t(o).fields,(d,m)=>(u(),G(z,{key:m,modelValue:t(o).fields[m],"onUpdate:modelValue":V=>t(o).fields[m]=V,onRemove:V=>U(m)},null,8,["modelValue","onUpdate:modelValue","onRemove"]))),128))])]),s("div",te,[r(l,{to:"/dashboard",color:"gray",variant:"ghost"},{default:i(()=>[...e[8]||(e[8]=[g("Cancelar",-1)])]),_:1}),r(l,{type:"submit",loading:t(p)},{default:i(()=>[...e[9]||(e[9]=[g("Criar Coleção",-1)])]),_:1},8,["loading"])])],32)])}}});export{me as default};
